var jsPsychGameIframe=function(t){"use strict";var S="0.0.1";const O={name:"plugin-game-iframe",version:S,parameters:{game_url:{type:t.ParameterType.STRING,default:void 0},post_message_type:{type:t.ParameterType.STRING,default:"game-complete"},allow_manual_end:{type:t.ParameterType.BOOL,default:!1},manual_end_delay:{type:t.ParameterType.INT,default:6e4},drawer_button_label:{type:t.ParameterType.STRING,default:"Menu"},emergency_button_label:{type:t.ParameterType.STRING,default:"Report a Technical Issue"},manual_end_button_label:{type:t.ParameterType.STRING,default:"End Game"},emergency_text_prompt:{type:t.ParameterType.HTML_STRING,default:"Please describe the technical issue you experienced:"},record_mouse_events:{type:t.ParameterType.BOOL,default:!1},mouse_sample_interval:{type:t.ParameterType.INT,default:0}},data:{exit_reason:{type:t.ParameterType.STRING},rt:{type:t.ParameterType.INT},game_data:{type:t.ParameterType.COMPLEX},emergency_text:{type:t.ParameterType.STRING},keystrokes:{type:t.ParameterType.COMPLEX},mouse_events:{type:t.ParameterType.COMPLEX}},citations:"__CITATIONS__"};class E{constructor(v){this.jsPsych=v}trial(v,a){const x=performance.now();let T=!1;const k=[],L=[];let P=0;const r=[],h=document.createElement("style");h.textContent=`
      .gi-container {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        z-index: 10000;
        background: #000;
      }
      .gi-iframe {
        width: 100%; height: 100%;
        border: none;
      }

      /* Drawer tab */
      .gi-drawer-tab {
        position: fixed;
        top: 50%; right: 0;
        transform: translateY(-50%);
        z-index: 10002;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        padding: 12px 6px;
        background: #444;
        color: #fff;
        border: none;
        border-radius: 6px 0 0 6px;
        cursor: pointer;
        font-size: 14px;
        font-family: sans-serif;
        letter-spacing: 1px;
      }
      .gi-drawer-tab:hover {
        background: #666;
      }

      /* Drawer panel */
      .gi-drawer-panel {
        position: fixed;
        top: 0; right: -320px;
        width: 320px; height: 100vh;
        background: #f5f5f5;
        z-index: 10003;
        transition: right 0.25s ease;
        display: flex;
        flex-direction: column;
        font-family: sans-serif;
        box-shadow: -2px 0 8px rgba(0,0,0,0.3);
      }
      .gi-drawer-panel.open {
        right: 0;
      }
      .gi-drawer-header {
        display: flex;
        justify-content: flex-end;
        padding: 8px 12px;
        border-bottom: 1px solid #ddd;
      }
      .gi-drawer-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #333;
        padding: 4px 8px;
      }
      .gi-drawer-body {
        padding: 20px;
        flex: 1;
        overflow-y: auto;
      }

      /* Emergency button */
      .gi-emergency-btn {
        width: 100%;
        padding: 12px;
        background: #d32f2f;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        margin-bottom: 16px;
      }
      .gi-emergency-btn:hover {
        background: #b71c1c;
      }

      /* Emergency form */
      .gi-emergency-form {
        display: none;
        margin-bottom: 16px;
      }
      .gi-emergency-form.visible {
        display: block;
      }
      .gi-emergency-form label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        color: #333;
      }
      .gi-emergency-form textarea {
        width: 100%;
        height: 100px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        resize: vertical;
        box-sizing: border-box;
        margin-bottom: 8px;
      }
      .gi-emergency-submit {
        width: 100%;
        padding: 10px;
        background: #d32f2f;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
      }
      .gi-emergency-submit:hover {
        background: #b71c1c;
      }

      /* Manual end button */
      .gi-manual-end-btn {
        width: 100%;
        padding: 12px;
        background: #1565c0;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        display: none;
      }
      .gi-manual-end-btn:hover {
        background: #0d47a1;
      }
      .gi-manual-end-btn.visible {
        display: block;
      }

      /* Overlay behind drawer */
      .gi-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.4);
        z-index: 10001;
        display: none;
      }
      .gi-overlay.visible {
        display: block;
      }
    `,document.head.appendChild(h),r.push(()=>h.remove());const o=document.createElement("div");o.className="gi-container";const i=document.createElement("iframe");i.className="gi-iframe",i.src=a.game_url,o.appendChild(i);const l=document.createElement("div");l.className="gi-overlay",o.appendChild(l);const u=document.createElement("button");u.className="gi-drawer-tab",u.textContent=a.drawer_button_label,o.appendChild(u);const d=document.createElement("div");d.className="gi-drawer-panel";const _=document.createElement("div");_.className="gi-drawer-header";const g=document.createElement("button");g.className="gi-drawer-close",g.innerHTML="&times;",_.appendChild(g),d.appendChild(_);const c=document.createElement("div");c.className="gi-drawer-body";const m=document.createElement("button");m.className="gi-emergency-btn",m.textContent=a.emergency_button_label,c.appendChild(m);const s=document.createElement("div");s.className="gi-emergency-form";const C=document.createElement("label");C.innerHTML=a.emergency_text_prompt,s.appendChild(C);const N=document.createElement("textarea");s.appendChild(N);const f=document.createElement("button");f.className="gi-emergency-submit",f.textContent="Submit & Exit",s.appendChild(f),c.appendChild(s);const p=document.createElement("button");p.className="gi-manual-end-btn",p.textContent=a.manual_end_button_label,c.appendChild(p),d.appendChild(c),o.appendChild(d),v.appendChild(o);const R=()=>{d.classList.add("open"),l.classList.add("visible")},I=()=>{d.classList.remove("open"),l.classList.remove("visible"),i.focus()};u.addEventListener("click",R),g.addEventListener("click",I),l.addEventListener("click",I),m.addEventListener("click",()=>{s.classList.add("visible"),m.style.display="none"}),f.addEventListener("click",()=>{w("emergency-exit",null,N.value||null)}),p.addEventListener("click",()=>{w("manual-end",null,null)}),a.allow_manual_end&&this.jsPsych.pluginAPI.setTimeout(()=>{p.classList.add("visible")},a.manual_end_delay);const b=e=>{k.push({key:e.key,event:e.type,t:Math.round(performance.now()-x)})},y=e=>{const n=performance.now();a.mouse_sample_interval>0&&e.type==="mousemove"&&n-P<a.mouse_sample_interval||(e.type==="mousemove"&&(P=n),L.push({x:e.clientX,y:e.clientY,t:Math.round(n-x),event:e.type}))},z=["keydown","keyup"],M=["mousemove","mousedown","mouseup","click"];for(const e of z)document.addEventListener(e,b,!0),r.push(()=>document.removeEventListener(e,b,!0));if(a.record_mouse_events)for(const e of M)document.addEventListener(e,y,!0),r.push(()=>document.removeEventListener(e,y,!0));const D=()=>{try{const e=i.contentDocument;if(!e)return;for(const n of z)e.addEventListener(n,b,!0),r.push(()=>e.removeEventListener(n,b,!0));if(a.record_mouse_events)for(const n of M)e.addEventListener(n,y,!0),r.push(()=>e.removeEventListener(n,y,!0))}catch(e){console.warn("plugin-game-iframe: Could not attach listeners to iframe (cross-origin?).",e)}};i.addEventListener("load",()=>{D(),i.focus()});const G=e=>{var n;e.data&&typeof e.data=="object"&&e.data.type===a.post_message_type&&w("game-complete",(n=e.data.data)!=null?n:null,null)};window.addEventListener("message",G),r.push(()=>window.removeEventListener("message",G));const w=(e,n,X)=>{if(T)return;T=!0;const B=Math.round(performance.now()-x);for(const H of r)H();o.remove(),this.jsPsych.finishTrial({exit_reason:e,rt:B,game_data:n,emergency_text:X,keystrokes:k,mouse_events:L})}}}return E.info=O,E}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
