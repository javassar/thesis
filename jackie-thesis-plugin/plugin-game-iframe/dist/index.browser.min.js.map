{"version":3,"file":"index.browser.min.js","sources":["../package.json","../src/index.ts"],"sourcesContent":["{\n  \"name\": \"plugin-game-iframe\",\n  \"version\": \"0.0.1\",\n  \"description\": \"Embed an HTML/JS game in a full-screen iframe with input logging and drawer UI\",\n  \"type\": \"module\",\n  \"main\": \"dist/index.cjs\",\n  \"exports\": {\n    \"import\": \"./dist/index.js\",\n    \"require\": \"./dist/index.cjs\"\n  },\n  \"typings\": \"dist/index.d.ts\",\n  \"unpkg\": \"dist/index.browser.min.js\",\n  \"files\": [\n    \"src\",\n    \"dist\"\n  ],\n  \"source\": \"src/index.ts\",\n  \"scripts\": {\n    \"test\": \"jest\",\n    \"test:watch\": \"npm test -- --watch\",\n    \"tsc\": \"tsc\",\n    \"build\": \"rollup --config\",\n    \"build:watch\": \"npm run build -- --watch\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"\",\n    \"directory\": \"./\"\n  },\n  \"keywords\": [\n    \"jsPsych\"\n  ],\n  \"author\": {\n    \"name\": \"Jackie\",\n    \"url\": \"\"\n  },\n  \"license\": \"MIT\",\n  \"bugs\": {\n    \"url\": \"/issues\"\n  },\n  \"homepage\": \"/plugin-game-iframe/README.md\",\n  \"dependencies\": {\n    \"jspsych\": \"^8.0.0\",\n    \"@citation-js/core\": \"^0.7.14\",\n    \"@citation-js/plugin-software-formats\": \"^0.6.1\",\n    \"@citation-js/plugin-bibtex\": \"^0.7.14\",\n    \"@citation-js/plugin-cff\": \"^0.6.1\"\n  },\n  \"devDependencies\": {\n    \"@jspsych/config\": \"^3.2.2\",\n    \"@jspsych/test-utils\": \"^1.0.0\"\n  }\n}\n","import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"plugin-game-iframe\",\n  version: version,\n  parameters: {\n    /** Path to the game HTML file (used as iframe src). Must be same-origin for input logging. */\n    game_url: {\n      type: ParameterType.STRING,\n      default: undefined,\n    },\n    /** The `type` field value in postMessage that signals the game is done. */\n    post_message_type: {\n      type: ParameterType.STRING,\n      default: \"game-complete\",\n    },\n    /** Whether to show a manual \"End Game\" button after a delay. */\n    allow_manual_end: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Milliseconds before the manual end button appears (if allow_manual_end is true). */\n    manual_end_delay: {\n      type: ParameterType.INT,\n      default: 60000,\n    },\n    /** Label for the drawer toggle tab on the right edge. */\n    drawer_button_label: {\n      type: ParameterType.STRING,\n      default: \"Menu\",\n    },\n    /** Label for the emergency exit button inside the drawer. */\n    emergency_button_label: {\n      type: ParameterType.STRING,\n      default: \"Report a Technical Issue\",\n    },\n    /** Label for the manual end button inside the drawer. */\n    manual_end_button_label: {\n      type: ParameterType.STRING,\n      default: \"End Game\",\n    },\n    /** Prompt text displayed above the emergency text area. */\n    emergency_text_prompt: {\n      type: ParameterType.HTML_STRING,\n      default: \"Please describe the technical issue you experienced:\",\n    },\n    /** Whether to record mouse events (mousemove, mousedown, mouseup, click). */\n    record_mouse_events: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Minimum milliseconds between mousemove samples. 0 means capture all events. Only used when record_mouse_events is true. */\n    mouse_sample_interval: {\n      type: ParameterType.INT,\n      default: 0,\n    },\n  },\n  data: {\n    /** The reason the trial ended: \"game-complete\", \"emergency-exit\", or \"manual-end\". */\n    exit_reason: {\n      type: ParameterType.STRING,\n    },\n    /** Reaction time in milliseconds from trial start to trial end. */\n    rt: {\n      type: ParameterType.INT,\n    },\n    /** Data payload from the game's postMessage, or null. */\n    game_data: {\n      type: ParameterType.COMPLEX,\n    },\n    /** Text entered in the emergency exit form, or null. */\n    emergency_text: {\n      type: ParameterType.STRING,\n    },\n    /** Array of keystroke events: { key, event, t }. */\n    keystrokes: {\n      type: ParameterType.COMPLEX,\n    },\n    /** Array of mouse events: { x, y, t, event }. */\n    mouse_events: {\n      type: ParameterType.COMPLEX,\n    },\n  },\n  citations: \"__CITATIONS__\",\n};\n\ntype Info = typeof info;\n\n/**\n * **plugin-game-iframe**\n *\n * Embed an HTML/JS game in a full-screen iframe with input logging and drawer UI.\n *\n * @author Jackie\n * @see {@link /plugin-game-iframe/README.md}\n */\nclass GameIframePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    const startTime = performance.now();\n    let trialEnded = false;\n\n    // Data arrays\n    const keystrokes: Array<{\n      key: string;\n      event: \"keydown\" | \"keyup\";\n      t: number;\n    }> = [];\n    const mouse_events: Array<{\n      x: number;\n      y: number;\n      t: number;\n      event: string;\n    }> = [];\n\n    // Track last mouse sample time for throttling\n    let lastMouseSampleTime = 0;\n\n    // Track all listeners for cleanup\n    const cleanupFns: Array<() => void> = [];\n\n    // ── CSS ──────────────────────────────────────────────────────────────\n\n    const style = document.createElement(\"style\");\n    style.textContent = `\n      .gi-container {\n        position: fixed;\n        top: 0; left: 0; width: 100vw; height: 100vh;\n        z-index: 10000;\n        background: #000;\n      }\n      .gi-iframe {\n        width: 100%; height: 100%;\n        border: none;\n      }\n\n      /* Drawer tab */\n      .gi-drawer-tab {\n        position: fixed;\n        top: 50%; right: 0;\n        transform: translateY(-50%);\n        z-index: 10002;\n        writing-mode: vertical-rl;\n        text-orientation: mixed;\n        padding: 12px 6px;\n        background: #444;\n        color: #fff;\n        border: none;\n        border-radius: 6px 0 0 6px;\n        cursor: pointer;\n        font-size: 14px;\n        font-family: sans-serif;\n        letter-spacing: 1px;\n      }\n      .gi-drawer-tab:hover {\n        background: #666;\n      }\n\n      /* Drawer panel */\n      .gi-drawer-panel {\n        position: fixed;\n        top: 0; right: -320px;\n        width: 320px; height: 100vh;\n        background: #f5f5f5;\n        z-index: 10003;\n        transition: right 0.25s ease;\n        display: flex;\n        flex-direction: column;\n        font-family: sans-serif;\n        box-shadow: -2px 0 8px rgba(0,0,0,0.3);\n      }\n      .gi-drawer-panel.open {\n        right: 0;\n      }\n      .gi-drawer-header {\n        display: flex;\n        justify-content: flex-end;\n        padding: 8px 12px;\n        border-bottom: 1px solid #ddd;\n      }\n      .gi-drawer-close {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #333;\n        padding: 4px 8px;\n      }\n      .gi-drawer-body {\n        padding: 20px;\n        flex: 1;\n        overflow-y: auto;\n      }\n\n      /* Emergency button */\n      .gi-emergency-btn {\n        width: 100%;\n        padding: 12px;\n        background: #d32f2f;\n        color: #fff;\n        border: none;\n        border-radius: 6px;\n        font-size: 15px;\n        cursor: pointer;\n        margin-bottom: 16px;\n      }\n      .gi-emergency-btn:hover {\n        background: #b71c1c;\n      }\n\n      /* Emergency form */\n      .gi-emergency-form {\n        display: none;\n        margin-bottom: 16px;\n      }\n      .gi-emergency-form.visible {\n        display: block;\n      }\n      .gi-emergency-form label {\n        display: block;\n        margin-bottom: 8px;\n        font-size: 14px;\n        color: #333;\n      }\n      .gi-emergency-form textarea {\n        width: 100%;\n        height: 100px;\n        padding: 8px;\n        border: 1px solid #ccc;\n        border-radius: 4px;\n        font-size: 14px;\n        resize: vertical;\n        box-sizing: border-box;\n        margin-bottom: 8px;\n      }\n      .gi-emergency-submit {\n        width: 100%;\n        padding: 10px;\n        background: #d32f2f;\n        color: #fff;\n        border: none;\n        border-radius: 6px;\n        font-size: 14px;\n        cursor: pointer;\n      }\n      .gi-emergency-submit:hover {\n        background: #b71c1c;\n      }\n\n      /* Manual end button */\n      .gi-manual-end-btn {\n        width: 100%;\n        padding: 12px;\n        background: #1565c0;\n        color: #fff;\n        border: none;\n        border-radius: 6px;\n        font-size: 15px;\n        cursor: pointer;\n        display: none;\n      }\n      .gi-manual-end-btn:hover {\n        background: #0d47a1;\n      }\n      .gi-manual-end-btn.visible {\n        display: block;\n      }\n\n      /* Overlay behind drawer */\n      .gi-overlay {\n        position: fixed;\n        top: 0; left: 0;\n        width: 100vw; height: 100vh;\n        background: rgba(0,0,0,0.4);\n        z-index: 10001;\n        display: none;\n      }\n      .gi-overlay.visible {\n        display: block;\n      }\n    `;\n    document.head.appendChild(style);\n    cleanupFns.push(() => style.remove());\n\n    // ── DOM ──────────────────────────────────────────────────────────────\n\n    // Full-screen container\n    const container = document.createElement(\"div\");\n    container.className = \"gi-container\";\n\n    // Iframe\n    const iframe = document.createElement(\"iframe\");\n    iframe.className = \"gi-iframe\";\n    iframe.src = trial.game_url;\n    container.appendChild(iframe);\n\n    // Overlay\n    const overlay = document.createElement(\"div\");\n    overlay.className = \"gi-overlay\";\n    container.appendChild(overlay);\n\n    // Drawer tab\n    const drawerTab = document.createElement(\"button\");\n    drawerTab.className = \"gi-drawer-tab\";\n    drawerTab.textContent = trial.drawer_button_label;\n    container.appendChild(drawerTab);\n\n    // Drawer panel\n    const drawerPanel = document.createElement(\"div\");\n    drawerPanel.className = \"gi-drawer-panel\";\n\n    // Drawer header with close button\n    const drawerHeader = document.createElement(\"div\");\n    drawerHeader.className = \"gi-drawer-header\";\n    const closeBtn = document.createElement(\"button\");\n    closeBtn.className = \"gi-drawer-close\";\n    closeBtn.innerHTML = \"&times;\";\n    drawerHeader.appendChild(closeBtn);\n    drawerPanel.appendChild(drawerHeader);\n\n    // Drawer body\n    const drawerBody = document.createElement(\"div\");\n    drawerBody.className = \"gi-drawer-body\";\n\n    // Emergency button\n    const emergencyBtn = document.createElement(\"button\");\n    emergencyBtn.className = \"gi-emergency-btn\";\n    emergencyBtn.textContent = trial.emergency_button_label;\n    drawerBody.appendChild(emergencyBtn);\n\n    // Emergency form (hidden initially)\n    const emergencyForm = document.createElement(\"div\");\n    emergencyForm.className = \"gi-emergency-form\";\n\n    const emergencyLabel = document.createElement(\"label\");\n    emergencyLabel.innerHTML = trial.emergency_text_prompt;\n    emergencyForm.appendChild(emergencyLabel);\n\n    const emergencyTextarea = document.createElement(\"textarea\");\n    emergencyForm.appendChild(emergencyTextarea);\n\n    const emergencySubmit = document.createElement(\"button\");\n    emergencySubmit.className = \"gi-emergency-submit\";\n    emergencySubmit.textContent = \"Submit & Exit\";\n    emergencyForm.appendChild(emergencySubmit);\n\n    drawerBody.appendChild(emergencyForm);\n\n    // Manual end button (hidden initially)\n    const manualEndBtn = document.createElement(\"button\");\n    manualEndBtn.className = \"gi-manual-end-btn\";\n    manualEndBtn.textContent = trial.manual_end_button_label;\n    drawerBody.appendChild(manualEndBtn);\n\n    drawerPanel.appendChild(drawerBody);\n    container.appendChild(drawerPanel);\n\n    display_element.appendChild(container);\n\n    // ── Drawer logic ────────────────────────────────────────────────────\n\n    const openDrawer = () => {\n      drawerPanel.classList.add(\"open\");\n      overlay.classList.add(\"visible\");\n    };\n\n    const closeDrawer = () => {\n      drawerPanel.classList.remove(\"open\");\n      overlay.classList.remove(\"visible\");\n      // Re-focus iframe so keyboard input reaches the game\n      iframe.focus();\n    };\n\n    drawerTab.addEventListener(\"click\", openDrawer);\n    closeBtn.addEventListener(\"click\", closeDrawer);\n    overlay.addEventListener(\"click\", closeDrawer);\n\n    // Emergency flow\n    emergencyBtn.addEventListener(\"click\", () => {\n      emergencyForm.classList.add(\"visible\");\n      emergencyBtn.style.display = \"none\";\n    });\n\n    emergencySubmit.addEventListener(\"click\", () => {\n      endTrial(\"emergency-exit\", null, emergencyTextarea.value || null);\n    });\n\n    // Manual end\n    manualEndBtn.addEventListener(\"click\", () => {\n      endTrial(\"manual-end\", null, null);\n    });\n\n    // Show manual end button after delay\n    if (trial.allow_manual_end) {\n      this.jsPsych.pluginAPI.setTimeout(() => {\n        manualEndBtn.classList.add(\"visible\");\n      }, trial.manual_end_delay);\n    }\n\n    // ── Event logging ───────────────────────────────────────────────────\n\n    const logKey = (e: KeyboardEvent) => {\n      keystrokes.push({\n        key: e.key,\n        event: e.type as \"keydown\" | \"keyup\",\n        t: Math.round(performance.now() - startTime),\n      });\n    };\n\n    const logMouse = (e: MouseEvent) => {\n      const now = performance.now();\n      if (\n        trial.mouse_sample_interval > 0 &&\n        e.type === \"mousemove\" &&\n        now - lastMouseSampleTime < trial.mouse_sample_interval\n      ) {\n        return;\n      }\n      if (e.type === \"mousemove\") {\n        lastMouseSampleTime = now;\n      }\n      mouse_events.push({\n        x: e.clientX,\n        y: e.clientY,\n        t: Math.round(now - startTime),\n        event: e.type,\n      });\n    };\n\n    // Attach listeners on main document\n    const keyEvents = [\"keydown\", \"keyup\"] as const;\n    const mouseEventTypes = [\n      \"mousemove\",\n      \"mousedown\",\n      \"mouseup\",\n      \"click\",\n    ] as const;\n\n    for (const evt of keyEvents) {\n      document.addEventListener(evt, logKey, true);\n      cleanupFns.push(() =>\n        document.removeEventListener(evt, logKey, true)\n      );\n    }\n\n    if (trial.record_mouse_events) {\n      for (const evt of mouseEventTypes) {\n        document.addEventListener(evt, logMouse, true);\n        cleanupFns.push(() =>\n          document.removeEventListener(evt, logMouse, true)\n        );\n      }\n    }\n\n    // Attach listeners on iframe document after it loads\n    const attachIframeListeners = () => {\n      try {\n        const iframeDoc = iframe.contentDocument;\n        if (!iframeDoc) return;\n\n        for (const evt of keyEvents) {\n          iframeDoc.addEventListener(evt, logKey, true);\n          cleanupFns.push(() =>\n            iframeDoc.removeEventListener(evt, logKey, true)\n          );\n        }\n\n        if (trial.record_mouse_events) {\n          for (const evt of mouseEventTypes) {\n            iframeDoc.addEventListener(evt, logMouse, true);\n            cleanupFns.push(() =>\n              iframeDoc.removeEventListener(evt, logMouse, true)\n            );\n          }\n        }\n      } catch (e) {\n        // Cross-origin: can't attach listeners to iframe document\n        console.warn(\n          \"plugin-game-iframe: Could not attach listeners to iframe (cross-origin?).\",\n          e\n        );\n      }\n    };\n\n    iframe.addEventListener(\"load\", () => {\n      attachIframeListeners();\n      iframe.focus();\n    });\n\n    // ── postMessage listener ────────────────────────────────────────────\n\n    const messageHandler = (event: MessageEvent) => {\n      if (\n        event.data &&\n        typeof event.data === \"object\" &&\n        event.data.type === trial.post_message_type\n      ) {\n        endTrial(\"game-complete\", event.data.data ?? null, null);\n      }\n    };\n\n    window.addEventListener(\"message\", messageHandler);\n    cleanupFns.push(() =>\n      window.removeEventListener(\"message\", messageHandler)\n    );\n\n    // ── End trial ───────────────────────────────────────────────────────\n\n    const endTrial = (\n      exit_reason: string,\n      game_data: any | null,\n      emergency_text: string | null\n    ) => {\n      if (trialEnded) return;\n      trialEnded = true;\n\n      const rt = Math.round(performance.now() - startTime);\n\n      // Cleanup all listeners\n      for (const fn of cleanupFns) {\n        fn();\n      }\n\n      // Remove DOM\n      container.remove();\n\n      this.jsPsych.finishTrial({\n        exit_reason,\n        rt,\n        game_data,\n        emergency_text,\n        keystrokes,\n        mouse_events,\n      });\n    };\n  }\n}\n\nexport default GameIframePlugin;\n"],"names":["version","info","ParameterType","GameIframePlugin","jsPsych","display_element","trial","startTime","trialEnded","keystrokes","mouse_events","lastMouseSampleTime","cleanupFns","style","container","iframe","overlay","drawerTab","drawerPanel","drawerHeader","closeBtn","drawerBody","emergencyBtn","emergencyForm","emergencyLabel","emergencyTextarea","emergencySubmit","manualEndBtn","openDrawer","closeDrawer","endTrial","logKey","logMouse","now","keyEvents","mouseEventTypes","evt","attachIframeListeners","iframeDoc","messageHandler","event","_a","exit_reason","game_data","emergency_text","rt","fn"],"mappings":"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"}